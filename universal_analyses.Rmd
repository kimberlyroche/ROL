---
title: "ROL universal analyses"
output: html_document
author: "Kim Roche"
date: "3/13/2020"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Selecting "universal" microbial interactions

This will give us a bird's eye view of the (CLR) correlations between microbes and across hosts. We'll load all individuals fitted MAP estimates of Sigma (microbial dynamics) using `load_MAP_estimates` for re-use in the next section, though it's not necessary.

```{r}
library(ROL)

tax_level <- "family"
logratio <- "clr"
Sigmas <- load_MAP_estimates(tax_level=tax_level, logratio=logratio)
```

Then plot the heatmap, where our 3 hosts are rows and all interactions between agglomerated families are columns. These are hierarchically clustered, such that like interaction (across hosts) should be visible as vertical stripes.

```{r}
plot_interaction_heatmap(tax_level=tax_level, logratio=logratio, Sigmas=Sigmas, taxon_idx=NULL, show_plot=TRUE)
```

We can subset to a single log relative abundance and *its* interactions with other log relative abundances by passing its index via `taxon_idx`.

```{r}
plot_interaction_heatmap(tax_level=tax_level, logratio=logratio, Sigmas=Sigmas, taxon_idx=1, show_plot=TRUE)
```

Lastly, filter all interactions for those that are "universal," i.e. that have the same correlation sign in a minimum proportion of hosts specified by `threshold`. For demonstration purposes, we'll set this bar low, via `threshold=0.4`.

```{r}
get_universal_interactions(tax_level=tax_level, threshold=0.4, show_plot=TRUE)
```

Note: These are always evaluated using CLR correlations.
